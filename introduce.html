<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 英文自我介紹工具</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .section { margin-bottom: 20px; }
        input, select { width: 100%; padding: 10px; margin: 10px 0; }
        button { padding: 10px 20px; background: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background: #45a049; }
        #output { white-space: pre-wrap; border: 1px solid #ccc; padding: 10px; }
        #chat-history { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
        .message { margin-bottom: 10px; }
        .user { color: blue; }
        .ai { color: green; }
        #step1, #step2, #step3 { display: none; }
        #step1 { display: block; } /* 初始顯示第一步 */
    </style>
</head>
<body>
	<img src="TLLF_logo.png" width="150"><font size="6">中華基督教會譚李麗芬紀念中學</font>
    <h1>AI 英文自我介紹工具</h1>
    <p>歡迎使用！請一步一步輸入您的個人資料，AI 將為您生成英文自我介紹。</p>

    <!-- 步驟1: 輸入個人資料 -->
    <div id="step1" class="section">
        <h2>步驟1: 輸入個人資料</h2>
        <label>姓名：</label><input type="text" id="name" placeholder="e.g., John Doe">
        <label>年齡：</label><input type="number" id="age" placeholder="e.g., 15">
        <label>興趣（用逗號分隔）：</label><input type="text" id="hobbies" placeholder="e.g., reading, sports, music">
        <label>英語水平：</label>
        <select id="englishLevel">
            <option value="beginner">初級 (Beginner)</option>
            <option value="intermediate">中級 (Intermediate)</option>
            <option value="advanced">高級 (Advanced)</option>
        </select>
        <button onclick="generateIntro()">生成自我介紹</button>
    </div>

    <!-- 步驟2: 顯示生成的自我介紹 -->
    <div id="step2" class="section">
        <h2>步驟2: 生成的英文自我介紹</h2>
        <div id="output"></div>
        <button onclick="startChat()">開始微調對話</button>
    </div>

    <!-- 步驟3: 聊天微調 -->
    <div id="step3" class="section">
        <h2>步驟3: 與 AI 對話微調</h2>
        <div id="chat-history"></div>
        <input type="text" id="userInput" placeholder="輸入您的修改建議...">
        <button onclick="sendMessage()">發送</button>
    </div>

    <script>
        const API_KEY = 'kSGGfrgFxvF3cnlPnQS0578zFiejG7hEuPigLy7-C3Y'; // 從 poe.com/api_key 獲取並替換
        const BASE_URL = 'https://api.poe.com/v1';
        const MODEL = 'gpt-3.5-turbo'; // 可替換為其他 Poe 支持模型

        let introText = ''; // 存儲生成的自我介紹
        let chatHistory = []; // 存儲聊天歷史，用於上下文

        // 生成自我介紹
        async function generateIntro() {
            const name = document.getElementById('name').value;
            const age = document.getElementById('age').value;
            const hobbies = document.getElementById('hobbies').value;
            const level = document.getElementById('englishLevel').value;

            if (!name || !age || !hobbies) {
                alert('請填寫所有欄位！');
                return;
            }

            const prompt = `Generate a self-introduction in English for a middle school student. Name: ${name}, Age: ${age}, Hobbies: ${hobbies}. Adjust the language to ${level} level. Keep it around 100-150 words.`;

            try {
                const response = await fetch(`${BASE_URL}/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: MODEL,
                        messages: [{ role: 'user', content: prompt }]
                    })
                });

                if (!response.ok) throw new Error('API 請求失敗');

                const data = await response.json();
                introText = data.choices[0].message.content;
                document.getElementById('output').innerText = introText;

                // 隱藏步驟1，顯示步驟2
                document.getElementById('step1').style.display = 'none';
                document.getElementById('step2').style.display = 'block';

                // 初始化聊天歷史
                chatHistory = [
                    { role: 'system', content: 'You are an AI helping to fine-tune this English self-introduction: ' + introText },
                    { role: 'user', content: 'Start fine-tuning.' }
                ];
            } catch (error) {
                alert('錯誤: ' + error.message);
            }
        }

        // 開始聊天
        function startChat() {
            document.getElementById('step2').style.display = 'none';
            document.getElementById('step3').style.display = 'block';
        }

        // 發送聊天消息
        async function sendMessage() {
            const userInput = document.getElementById('userInput').value;
            if (!userInput) return;

            // 添加用戶消息到歷史
            addMessageToChat('user', userInput);
            chatHistory.push({ role: 'user', content: userInput });
            document.getElementById('userInput').value = '';

            try {
                const response = await fetch(`${BASE_URL}/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: MODEL,
                        messages: chatHistory
                    })
                });

                if (!response.ok) throw new Error('API 請求失敗');

                const data = await response.json();
                const aiResponse = data.choices[0].message.content;

                // 添加 AI 回應到歷史
                addMessageToChat('ai', aiResponse);
                chatHistory.push({ role: 'assistant', content: aiResponse });

                // 更新生成的自我介紹（如果 AI 提供了新版本）
                if (aiResponse.includes('Updated self-introduction:')) {
                    introText = aiResponse.split('Updated self-introduction:')[1].trim();
                }
            } catch (error) {
                alert('錯誤: ' + error.message);
            }
        }

        // 添加消息到聊天歷史顯示
        function addMessageToChat(sender, text) {
            const chatDiv = document.getElementById('chat-history');
            const msgDiv = document.createElement('div');
            msgDiv.className = 'message ' + sender;
            msgDiv.innerText = (sender === 'user' ? '您: ' : 'AI: ') + text;
            chatDiv.appendChild(msgDiv);
            chatDiv.scrollTop = chatDiv.scrollHeight;
        }
    </script>
</body>
</html>